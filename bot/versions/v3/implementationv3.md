# üéâ Telegram Bot v3.0 - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–Ω–æ–≤—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
2. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ-–∏–∑–º–µ–Ω–µ–Ω–∏—è)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
4. [–ê–ª–≥–æ—Ä–∏—Ç–º—ã —Ä–∞–±–æ—Ç—ã](#–∞–ª–≥–æ—Ä–∏—Ç–º—ã-—Ä–∞–±–æ—Ç—ã)
5. [API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#api-–∏-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)

---

## üöÄ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ö–æ–º–∞–Ω–¥—ã —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### `/rm_user @username`
–£–¥–∞–ª—è–µ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤ —Ç–µ–∫—É—â–µ–º –∫–∞–Ω–∞–ª–µ.

**–°–ø–æ—Å–æ–±—ã –≤—ã–∑–æ–≤–∞:**
- `/rm_user @username` - –ø–æ username
- `/rm_user 123456789` - –ø–æ telegram ID
- Reply –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ + `/rm_user` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑ reply

**–ü—Ä–∏–º–µ—Ä:**
```
/rm_user @ivan
‚Üí ‚úÖ –£–¥–∞–ª–µ–Ω –∏–∑ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
```

#### `/rm_users @user1 @user2 @user3`
–ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏:** –ø—Ä–æ–±–µ–ª, –∑–∞–ø—è—Ç–∞—è, —Ç–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π

**–ü—Ä–∏–º–µ—Ä:**
```
/rm_users @ivan @petr @maria
‚Üí ‚úÖ –£—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã: @ivan, @petr, @maria
```

---

### 2. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏

#### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤
–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–æ 24 —Å–∏–º–≤–æ–ª–æ–≤, –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
- –ü—Ä–æ–±–µ–ª—ã
- –°–ª–µ—à–∏ (/)
- –î–µ—Ñ–∏—Å—ã (-)
- –¶–∏—Ñ—Ä—ã

**–§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã:**
```
/add_event "–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ" –ß–ß:–ú–ú [–º–∏–Ω_—Ñ–æ—Ç–æ]
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```
/add_event "–ö–∞—Å—Å–∞ 1 —É—Ç—Ä–æ" 10:00 1
/add_event "–°–∫–ª–∞–¥/–≤–µ—á–µ—Ä" 18:00 2
/add_event "–ü—Ä–æ–≤–µ—Ä–∫–∞-—ç–∫—Å–ø—Ä–µ—Å—Å" 14:00 1
```

#### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
2. –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–±–µ–ª–æ–≤
3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫

**–ü—Ä–∏–º–µ—Ä:**
```python
–≠—Ç–∞–ª–æ–Ω: "–ö–∞—Å—Å–∞ 1 —É—Ç—Ä–æ"
–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: "–∫–∞—Å—Å–∞1—É—Ç—Ä–æ"

–ü–æ–¥—Ö–æ–¥—è—â–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
‚úÖ "–ö–∞—Å—Å–∞ 1 —É—Ç—Ä–æ"
‚úÖ "–∫–∞—Å—Å–∞ 1 —É—Ç—Ä–æ"
‚úÖ "–ö–ê–°–°–ê 1 –£–¢–†–û"
‚úÖ "–∫–∞—Å—Å–∞1—É—Ç—Ä–æ"
‚úÖ "–ö–∞—Å—Å–∞  1  —É—Ç—Ä–æ" (–¥–≤–æ–π–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã)

–ù–µ –ø–æ–¥—Ö–æ–¥—è—Ç:
‚ùå "–ö–∞—Å—Å–∞ 2 —É—Ç—Ä–æ"
‚ùå "–ö–∞—Å–∞ 1 —É—Ç—Ä–æ"
```

---

### 3. –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

#### `/add_tmp_event "–ù–∞–∑–≤–∞–Ω–∏–µ" –ß–ß:–ú–ú [–º–∏–Ω_—Ñ–æ—Ç–æ]`
–°–æ–∑–¥–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—Å—è –≤ 23:59 –ú–°–ö.

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –†–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –í–Ω–µ–ø–ª–∞–Ω–æ–≤—ã–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

**–ü—Ä–∏–º–µ—Ä:**
```
/add_tmp_event "–í–Ω–µ–ø–ª–∞–Ω–æ–≤–∞—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è" 15:00 3
‚Üí ‚úÖ –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ
   ‚è± –£–¥–∞–ª–∏—Ç—Å—è: 23:59 –ú–°–ö
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
- –£–¥–∞–ª—è–µ—Ç—Å—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –≤ 23:59
- –†–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–µ–º–∏ –∂–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –∏ –æ–±—ã—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

---

### 4. –î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (Checkout)

#### `/add_event_checkout "–ö–ª—é—á1" –ß–ß:–ú–ú "–ö–ª—é—á2" –ß–ß:–ú–ú [–º–∏–Ω_—Ñ–æ—Ç–æ]`

–°–æ–∑–¥–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ —Å –¥–≤—É–º—è —ç—Ç–∞–ø–∞–º–∏:
1. **–ü–µ—Ä–≤—ã–π —ç—Ç–∞–ø (–ø–µ—Ä–µ—Å—á–µ—Ç)** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞—è–≤–ª—è—é—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
2. **–í—Ç–æ—Ä–æ–π —ç—Ç–∞–ø (–æ—Ç—á–µ—Ç—ã)** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–¥–∞—é—Ç —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç—ã

**–ü—Ä–∏–º–µ—Ä:**
```
/add_event_checkout "–ü–µ—Ä–µ—Å—á–µ—Ç" 10:00 "–ì–æ—Ç–æ–≤–æ" 16:00 1
```

#### –≠—Ç–∞–ø 1: –ü–µ—Ä–µ—Å—á–µ—Ç (—É—Ç—Ä–æ)

**–§–æ—Ä–º–∞—Ç:**
```
[–ü–µ—Ä–≤—ã–π –∫–ª—é—á]: [–∫–∞—Ç–µ–≥–æ—Ä–∏—è1] [+/] [–∫–∞—Ç–µ–≥–æ—Ä–∏—è2] ...
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```
–ü–µ—Ä–µ—Å—á–µ—Ç: —Å–∫–æ—Ä–æ–ø–æ—Ä—Ç + —Ç–∏—Ö–æ–µ + –±–∞–∫–∞–ª–µ—è
–ü–µ—Ä–µ—Å—á–µ—Ç: —ç–ª–∏—Ç–∫–∞ / –≤–æ–¥–∫–∞ / —Å–∏–≥–∞—Ä–µ—Ç—ã
–ü–µ—Ä–µ—Å—á–µ—Ç: –ø–∏–≤–æ –∫–æ–∫—Ç–µ–π–ª–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∏
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ë–æ—Ç –ø–∞—Ä—Å–∏—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ç–æ–ª—å–∫–æ –∏–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞)
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `checkout_submissions`
3. –û—Ç–≤–µ—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º

**–û—Ç–≤–µ—Ç –±–æ—Ç–∞:**
```
‚úÖ –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏–Ω—è—Ç!

üìã –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: —Å–∫–æ—Ä–æ–ø–æ—Ä—Ç, —Ç–∏—Ö–æ–µ, –±–∞–∫–∞–ª–µ—è
‚è∞ –î–æ 16:00 –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç—ã —Å —É–∫–∞–∑–∞–Ω–∏–µ–º:
–ì–æ—Ç–æ–≤–æ: [–∫–∞—Ç–µ–≥–æ—Ä–∏—è]
```

#### –≠—Ç–∞–ø 2: –§–æ—Ç–æ–æ—Ç—á–µ—Ç—ã (–≤–µ—á–µ—Ä)

**–§–æ—Ä–º–∞—Ç:**
```
[–í—Ç–æ—Ä–æ–π –∫–ª—é—á]: [–∫–∞—Ç–µ–≥–æ—Ä–∏—è]
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```
–ì–æ—Ç–æ–≤–æ: —Å–∫–æ—Ä–æ–ø–æ—Ä—Ç
–ì–æ—Ç–æ–≤–æ: —Ç–∏—Ö–æ–µ
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –±—ã–ª–∞ –≤ submission
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `checkout_reports`
3. –í—ã—á–∏—Å–ª—è–µ—Ç –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
4. –û—Ç–≤–µ—á–∞–µ—Ç —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º

**–û—Ç–≤–µ—Ç—ã –±–æ—Ç–∞:**

–ï—Å–ª–∏ —Å–¥–∞–Ω–∞ 1 –∏–∑ 3:
```
‚úÖ @username —É—Å–ø–µ—à–Ω–æ —Å–¥–∞–ª –æ—Ç—á–µ—Ç –ø–æ: —Å–∫–æ—Ä–æ–ø–æ—Ä—Ç

üìã –ï—â–µ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–∞—Ç—å –æ—Ç—á–µ—Ç –ø–æ: —Ç–∏—Ö–æ–µ, –±–∞–∫–∞–ª–µ—è
```

–ï—Å–ª–∏ —Å–¥–∞–Ω–æ –≤—Å—ë:
```
‚úÖ @username —É—Å–ø–µ—à–Ω–æ —Å–¥–∞–ª –≤—Å–µ –æ—Ç—á–µ—Ç—ã, —Å–ø–∞—Å–∏–±–æ! üéâ
```

#### –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

```python
ALLOWED_CHECKOUT_KEYWORDS = [
    "—ç–ª–∏—Ç–∫–∞", "—Å–∏–≥–∞—Ä–µ—Ç—ã", "—Ç–∏—Ö–æ–µ", "–≤–æ–¥–∫–∞", "–ø–∏–≤–æ", 
    "–∏–≥—Ä–∏—Å—Ç–æ–µ", "–∫–æ–∫—Ç–µ–π–ª–∏", "—Å–∫–æ—Ä–æ–ø–æ—Ä—Ç", "—Å–æ–ø—É—Ç–∫–∞", 
    "–≤–æ–¥–∞", "—ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∏", "–±–∞–∫–∞–ª–µ—è", "–º–æ—Ä–æ–∂–µ–Ω–æ–µ", 
    "—à–æ–∫–æ–ª–∞–¥", "–Ω–æ–Ω—Ñ—É–¥"
]
```

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ 22:00

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:

```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ–±—ã—Ç–∏—é '–ü–µ—Ä–µ—Å—á–µ—Ç'

‚úÖ –°–¥–∞–ª–∏ –æ—Ç—á–µ—Ç—ã –≤–æ–≤—Ä–µ–º—è:
1. @user1
2. @user2

‚ö†Ô∏è –ù–µ–º–Ω–æ–≥–æ –æ–ø–æ–∑–¥–∞–ª–∏ —Å–æ —Å–¥–∞—á–µ–π –æ—Ç—á–µ—Ç–æ–≤:
1. @user3 (—Å–¥–∞–ª –≤ 16:15)
2. @user4 (—Å–¥–∞–ª –≤ 16:30)

‚ùå –î–æ —Å–∏—Ö –ø–æ—Ä –Ω–µ —Å–¥–∞–ª–∏ –æ—Ç—á–µ—Ç (–∏–ª–∏ –æ—Ç—á–µ—Ç—ã):
1. @user5
2. @user6

–¢–µ, –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑–∞–Ω—ã –≤ —ç—Ç–æ–º —Å–ø–∏—Å–∫–µ ‚Äî –∂–¥—É –ø—Ä–∏—á–∏–Ω—É –ø–æ—á–µ–º—É, 
–æ—Å—Ç–∞–ª—å–Ω—ã–º –≤—ã—Ä–∞–∂–∞—é –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –≤–∞—à—É —Ä–∞–±–æ—Ç—É!
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏

#### 1. `bot/database/models.py`

**–ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `TempEvent` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- `CheckoutEvent` - –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- `CheckoutSubmission` - –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ
- `CheckoutReport` - –æ—Ç—á–µ—Ç—ã –Ω–∞ –≤—Ç–æ—Ä–æ–º —ç—Ç–∞–ø–µ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö:**
- `Report.temp_event_id` - —Å–≤—è–∑—å —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏

#### 2. `bot/database/crud.py`

**–ù–æ–≤—ã–µ CRUD –∫–ª–∞—Å—Å—ã:**
- `TempEventCRUD` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏
- `CheckoutEventCRUD` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å checkout —Å–æ–±—ã—Ç–∏—è–º–∏
- `CheckoutSubmissionCRUD` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏
- `CheckoutReportCRUD` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞–º–∏

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
```python
normalize_keyword(keyword: str) -> str
# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞

extract_keywords_from_text(text: str, reference_keyword: str) -> bool
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞

parse_checkout_keywords(text: str) -> List[str]
# –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è checkout
```

#### 3. `bot/handlers/admin.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–º–∞–Ω–¥–∞—Ö:**
- `/add_event` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–≤—ã—á–µ–∫ —á–µ—Ä–µ–∑ `shlex.split()`
- `/rm_user` - –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/rm_users` - –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è

**–ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
- `/add_tmp_event` - —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
- `/add_event_checkout` - —Å–æ–∑–¥–∞–Ω–∏–µ checkout —Å–æ–±—ã—Ç–∏—è

**–£–ª—É—á—à–µ–Ω–∏—è:**
- Emoji –≤ –æ—Ç–≤–µ—Ç–∞—Ö –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∫–æ–º–∞–Ω–¥

#### 4. `bot/handlers/reports.py`

**–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```python
handle_checkout_first_phase()  # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ—Å—á–µ—Ç–∞
handle_photo_message()         # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ (–≤—Å–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π)
```

**–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–±—ã—Ç–∏–π:**
1. Checkout —Å–æ–±—ã—Ç–∏—è (–≤—Ç–æ—Ä–æ–π —ç—Ç–∞–ø)
2. –û–±—ã—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
3. –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

**–õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ checkout:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è submission
2. –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ —Ñ–æ—Ç–æ
3. –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
4. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–∞
5. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞

#### 5. `bot/scheduler/tasks.py`

**–ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏:**
```python
cleanup_temp_events()           # 23:59 - —É–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
send_checkout_daily_stats()     # 22:00 - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ checkout
check_checkout_deadlines()      # –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É - –ø—Ä–æ–≤–µ—Ä–∫–∞ checkout
```

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
- `check_deadline_warnings()` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- `check_deadlines()` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ checkout —Å–æ–±—ã—Ç–∏–π

---

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π

```
User
‚îú‚îÄ UserChannel ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ Channel
‚îÇ                 ‚îÇ    ‚îú‚îÄ‚îÄ Event
‚îÇ                 ‚îÇ    ‚îÇ    ‚îî‚îÄ‚îÄ Report
‚îÇ                 ‚îÇ    ‚îú‚îÄ‚îÄ TempEvent
‚îÇ                 ‚îÇ    ‚îÇ    ‚îî‚îÄ‚îÄ Report
‚îÇ                 ‚îÇ    ‚îî‚îÄ‚îÄ CheckoutEvent
‚îÇ                 ‚îÇ         ‚îú‚îÄ‚îÄ CheckoutSubmission
‚îÇ                 ‚îÇ         ‚îî‚îÄ‚îÄ CheckoutReport
‚îú‚îÄ CheckoutSubmission
‚îú‚îÄ CheckoutReport
‚îú‚îÄ Report
‚îî‚îÄ Stats
```

### –¢–∞–±–ª–∏—Ü–∞ `temp_events`

```sql
CREATE TABLE temp_events (
    id INTEGER PRIMARY KEY,
    channel_id INTEGER NOT NULL,
    keyword VARCHAR(100) NOT NULL,
    deadline_time TIME NOT NULL,
    min_photos INTEGER NOT NULL DEFAULT 1,
    event_date DATE NOT NULL,
    template_file_id VARCHAR(255),
    template_hash VARCHAR(64),
    template_phash VARCHAR(64),
    created_at DATETIME NOT NULL,
    FOREIGN KEY (channel_id) REFERENCES channels(id) ON DELETE CASCADE,
    UNIQUE (channel_id, keyword, event_date)
);
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- `(channel_id, event_date)` - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–Ω—è

### –¢–∞–±–ª–∏—Ü–∞ `checkout_events`

```sql
CREATE TABLE checkout_events (
    id INTEGER PRIMARY KEY,
    channel_id INTEGER NOT NULL,
    first_keyword VARCHAR(100) NOT NULL,
    first_deadline_time TIME NOT NULL,
    second_keyword VARCHAR(100) NOT NULL,
    second_deadline_time TIME NOT NULL,
    min_photos INTEGER NOT NULL DEFAULT 1,
    allowed_keywords TEXT,  -- JSON array
    created_at DATETIME NOT NULL,
    FOREIGN KEY (channel_id) REFERENCES channels(id) ON DELETE CASCADE
);
```

### –¢–∞–±–ª–∏—Ü–∞ `checkout_submissions`

```sql
CREATE TABLE checkout_submissions (
    id INTEGER PRIMARY KEY,
    user_id INTEGER NOT NULL,
    checkout_event_id INTEGER NOT NULL,
    submission_date DATE NOT NULL,
    submitted_at DATETIME NOT NULL,
    keywords TEXT NOT NULL,  -- JSON array: ["—Å–∫–æ—Ä–æ–ø–æ—Ä—Ç", "—Ç–∏—Ö–æ–µ"]
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (checkout_event_id) REFERENCES checkout_events(id) ON DELETE CASCADE,
    UNIQUE (user_id, checkout_event_id, submission_date)
);
```

### –¢–∞–±–ª–∏—Ü–∞ `checkout_reports`

```sql
CREATE TABLE checkout_reports (
    id INTEGER PRIMARY KEY,
    user_id INTEGER NOT NULL,
    checkout_event_id INTEGER NOT NULL,
    report_date DATE NOT NULL,
    submitted_at DATETIME NOT NULL,
    message_id INTEGER NOT NULL,
    photos_count INTEGER NOT NULL,
    keywords TEXT NOT NULL,  -- JSON array: ["—Å–∫–æ—Ä–æ–ø–æ—Ä—Ç"]
    is_complete BOOLEAN NOT NULL DEFAULT 0,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (checkout_event_id) REFERENCES checkout_events(id) ON DELETE CASCADE
);
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- `(user_id, checkout_event_id, report_date)` - –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ—Ç—á–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `(checkout_event_id, report_date)` - –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

---

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º—ã —Ä–∞–±–æ—Ç—ã

### –ê–ª–≥–æ—Ä–∏—Ç–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞

```python
def normalize_keyword(keyword: str) -> str:
    """
    –®–∞–≥–∏:
    1. –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
    2. –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ (–∑–∞–º–µ–Ω—è–µ–º –≤—Å–µ –Ω–∞ '')
    3. –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    """
    return re.sub(r'\s+', '', keyword.lower().strip())

# –ü—Ä–∏–º–µ—Ä—ã:
normalize_keyword("–ö–∞—Å—Å–∞ 1 —É—Ç—Ä–æ")    # ‚Üí "–∫–∞—Å—Å–∞1—É—Ç—Ä–æ"
normalize_keyword("–ö–ê–°–°–ê 1 –£–¢–†–û")    # ‚Üí "–∫–∞—Å—Å–∞1—É—Ç—Ä–æ"
normalize_keyword("–∫–∞—Å—Å–∞  1  —É—Ç—Ä–æ")  # ‚Üí "–∫–∞—Å—Å–∞1—É—Ç—Ä–æ"
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞

```python
def extract_keywords_from_text(text: str, reference_keyword: str) -> bool:
    """
    –®–∞–≥–∏:
    1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    2. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —ç—Ç–∞–ª–æ–Ω–Ω–æ–≥–æ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
    3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–∂–¥–µ–Ω–∏—è (substring match)
    """
    normalized_text = normalize_keyword(text)
    normalized_reference = normalize_keyword(reference_keyword)
    return normalized_reference in normalized_text
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø–∞—Ä—Å–∏–Ω–≥–∞ checkout –∫–∞—Ç–µ–≥–æ—Ä–∏–π

```python
def parse_checkout_keywords(text: str) -> List[str]:
    """
    –®–∞–≥–∏:
    1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º (+, /, –ø—Ä–æ–±–µ–ª)
    2. –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
    3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–ª–æ–≤–∞—Ä—é –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å–ª–æ–≤
    4. –í–æ–∑–≤—Ä–∞—Ç —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    """
    words = re.split(r'[+/\s]+', text.lower().strip())
    result = []
    for word in words:
        word_clean = word.strip()
        if word_clean in ALLOWED_CHECKOUT_KEYWORDS:
            result.append(word_clean)
    return result

# –ü—Ä–∏–º–µ—Ä—ã:
parse_checkout_keywords("—Å–∫–æ—Ä–æ–ø–æ—Ä—Ç + —Ç–∏—Ö–æ–µ + –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ")
# ‚Üí ["—Å–∫–æ—Ä–æ–ø–æ—Ä—Ç", "—Ç–∏—Ö–æ–µ"]

parse_checkout_keywords("—ç–ª–∏—Ç–∫–∞/–≤–æ–¥–∫–∞/–ø–∏–≤–æ")
# ‚Üí ["—ç–ª–∏—Ç–∫–∞", "–≤–æ–¥–∫–∞", "–ø–∏–≤–æ"]
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π

```python
async def get_remaining_keywords(
    session: AsyncSession, 
    user_id: int, 
    checkout_event_id: int
) -> List[str]:
    """
    –®–∞–≥–∏:
    1. –ü–æ–ª—É—á–∏—Ç—å submission –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á—Ç–æ –∑–∞—è–≤–∏–ª —É—Ç—Ä–æ–º)
    2. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ reports –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á—Ç–æ —É–∂–µ —Å–¥–∞–ª)
    3. –í—ã—á–∏—Å–ª–∏—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –º–Ω–æ–∂–µ—Å—Ç–≤
    4. –í–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    """
    submission = await get_today_submission(session, user_id, checkout_event_id)
    submitted_keywords = set(json.loads(submission.keywords))
    
    reports = await get_today_reports(session, user_id, checkout_event_id)
    reported_keywords = set()
    for report in reports:
        reported_keywords.update(json.loads(report.keywords))
    
    remaining = submitted_keywords - reported_keywords
    return list(remaining)
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å

### –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ checkout (22:00)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –î–ª—è –∫–∞–∂–¥–æ–≥–æ checkout —Å–æ–±—ã—Ç–∏—è –≤ –∫–∞–∂–¥–æ–º –∫–∞–Ω–∞–ª–µ:
   - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–∞–Ω–∞–ª–∞
   - –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
     - ‚úÖ –°–¥–∞–ª–∏ –≤–æ–≤—Ä–µ–º—è (–¥–æ `second_deadline_time`)
     - ‚ö†Ô∏è –ù–µ–º–Ω–æ–≥–æ –æ–ø–æ–∑–¥–∞–ª–∏ (–ø–æ—Å–ª–µ –¥–µ–¥–ª–∞–π–Ω–∞, –Ω–æ —Å–¥–∞–ª–∏)
     - ‚ùå –ù–µ —Å–¥–∞–ª–∏ (–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç submission –∏–ª–∏ –Ω–µ–ø–æ–ª–Ω—ã–µ reports)

2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
   ```
   üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ–±—ã—Ç–∏—é '{first_keyword}'
   
   ‚úÖ –°–¥–∞–ª–∏ –≤–æ–≤—Ä–µ–º—è: [—Å–ø–∏—Å–æ–∫]
   ‚ö†Ô∏è –û–ø–æ–∑–¥–∞–ª–∏: [—Å–ø–∏—Å–æ–∫ —Å –≤—Ä–µ–º–µ–Ω–µ–º]
   ‚ùå –ù–µ —Å–¥–∞–ª–∏: [—Å–ø–∏—Å–æ–∫]
   ```

3. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –∫–∞–Ω–∞–ª

**–ö–æ–¥:**
```python
async def send_checkout_stats_for_event(
    session, channel, checkout_event, today
):
    users = await UserChannelCRUD.get_users_by_channel(session, channel.id)
    
    on_time = []
    late = []
    not_submitted = []
    
    for user in users:
        # –õ–æ–≥–∏–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏...
    
    # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

1. **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ checkout:**
   - –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ —Å–ª–æ–≤–∞—Ä—é
   - –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–ª–æ–≤
   - –ó–∞—â–∏—Ç–∞ –æ—Ç injection

2. **–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:**
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã (24 —Å–∏–º–≤–æ–ª–∞)
   - –û—á–∏—Å—Ç–∫–∞ –æ—Ç —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤ –ø—Ä–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –∫–∞–Ω–∞–ª—É
   - –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è–º–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
try:
    # –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
    await CheckoutEventCRUD.create(...)
except IntegrityError:
    await message.answer("‚ùå –¢–∞–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
except Exception as e:
    logger.error(f"Error: {e}", exc_info=True)
    await message.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞")
```

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ò–Ω–¥–µ–∫—Å—ã –ë–î:**
   - `(channel_id, event_date)` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–Ω—è
   - `(user_id, checkout_event_id, report_date)` –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ—Ç—á–µ—Ç–æ–≤

2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - `reminders_sent_today` - –∫—ç—à –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
   - `warnings_sent_today` - –∫—ç—à –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
   - `checkout_reminders_sent` - –∫—ç—à checkout –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

3. **–ü–∞–∫–µ—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**
   - –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
   - –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±—ã—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å –Ω–æ–≤—ã–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º
```
1. /add_channel TestChannel
2. /add_event "–¢–µ—Å—Ç 1 —É—Ç—Ä–æ" 10:00 1
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º "—Ç–µ—Å—Ç1—É—Ç—Ä–æ"
4. –û–∂–∏–¥–∞—Ç—å: ‚úÖ –û—Ç—á–µ—Ç –ø—Ä–∏–Ω—è—Ç
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
```
1. /add_tmp_event "–†–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞" 15:00 1
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –¥–æ 15:00
3. –î–æ–∂–¥–∞—Ç—å—Å—è 23:59
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –∏–∑ –ë–î
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: Checkout —Å–æ–±—ã—Ç–∏–µ (–ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª)
```
1. /add_event_checkout "–ü–µ—Ä–µ—Å—á–µ—Ç" 10:00 "–ì–æ—Ç–æ–≤–æ" 16:00 1
2. –î–æ 10:00: –Ω–∞–ø–∏—Å–∞—Ç—å "–ü–µ—Ä–µ—Å—á–µ—Ç: —Å–∫–æ—Ä–æ–ø–æ—Ä—Ç + —Ç–∏—Ö–æ–µ"
3. –î–æ 16:00: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ "–ì–æ—Ç–æ–≤–æ: —Å–∫–æ—Ä–æ–ø–æ—Ä—Ç"
4. –î–æ 16:00: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ "–ì–æ—Ç–æ–≤–æ: —Ç–∏—Ö–æ–µ"
5. –û–∂–∏–¥–∞—Ç—å: ‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–¥–∞–ª –≤—Å–µ –æ—Ç—á–µ—Ç—ã
6. –í 22:00: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–¥–∞

### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### `normalize_keyword(keyword: str) -> str`
–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `keyword` - –∏—Å—Ö–æ–¥–Ω–æ–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ (lowercase, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)

**–ü—Ä–∏–º–µ—Ä:**
```python
normalize_keyword("–ö–∞—Å—Å–∞ 1 —É—Ç—Ä–æ")  # ‚Üí "–∫–∞—Å—Å–∞1—É—Ç—Ä–æ"
```

#### `parse_checkout_keywords(text: str) -> List[str]`
–ü–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è checkout —Å–æ–±—ã—Ç–∏–π.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `text` - —Ç–µ–∫—Å—Ç –≤–∏–¥–∞ "—Å–∫–æ—Ä–æ–ø–æ—Ä—Ç+–≤–∏–Ω–æ" –∏–ª–∏ "—ç–ª–∏—Ç–∫–∞ / —Ç–∏—Ö–æ–µ"

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –°–ø–∏—Å–æ–∫ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ —Å–ª–æ–≤–∞—Ä—è

**–ü—Ä–∏–º–µ—Ä:**
```python
parse_checkout_keywords("—Å–∫–æ—Ä–æ–ø–æ—Ä—Ç + —Ç–∏—Ö–æ–µ + unknown")
# ‚Üí ["—Å–∫–æ—Ä–æ–ø–æ—Ä—Ç", "—Ç–∏—Ö–æ–µ"]
```

#### `CheckoutReportCRUD.get_remaining_keywords()`
–ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –Ω–µ —Å–¥–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `session` - —Å–µ—Å—Å–∏—è –ë–î
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `checkout_event_id` - ID checkout —Å–æ–±—ã—Ç–∏—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- –°–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–õ–æ–≥–∏–∫–∞:**
```python
submitted = ["—Å–∫–æ—Ä–æ–ø–æ—Ä—Ç", "—Ç–∏—Ö–æ–µ", "–±–∞–∫–∞–ª–µ—è"]  # –£—Ç—Ä–æ–º –∑–∞—è–≤–∏–ª
reported = ["—Å–∫–æ—Ä–æ–ø–æ—Ä—Ç"]                         # –í–µ—á–µ—Ä–æ–º —Å–¥–∞–ª
remaining = submitted - reported                 # –û—Å—Ç–∞–ª–æ—Å—å —Å–¥–∞—Ç—å
# ‚Üí ["—Ç–∏—Ö–æ–µ", "–±–∞–∫–∞–ª–µ—è"]
```

---

## üéì –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í–µ—Ä—Å–∏—è 3.0 –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞:

‚úÖ –ì–∏–±–∫–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Ä–∞–∑–æ–≤—ã—Ö –∑–∞–¥–∞—á
‚úÖ –î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.