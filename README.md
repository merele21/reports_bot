# Telegram Bot –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ—Ç—á–µ—Ç–æ–≤

–ë–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è —Å–¥–∞—á–∏ –æ—Ç—á–µ—Ç–æ–≤ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ –≤ Telegram-–∫–∞–Ω–∞–ª–∞—Ö.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–Ω–∞–ª–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–µ–¥–ª–∞–π–Ω–∞–º–∏
- üì∏ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
- üîë –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –≤ –æ—Ç—á–µ—Ç–∞—Ö
- ‚è∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–ø—É—Å–∫–µ –¥–µ–¥–ª–∞–π–Ω–∞
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- üîß –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Python 3.11+
- aiogram 3.x
- SQLAlchemy 2.0
- APScheduler
- PostgreSQL / SQLite
- Docker

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository_url>
cd report_bot
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
nano .env
```

–£–∫–∞–∂–∏—Ç–µ:

- `BOT_TOKEN` - —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –æ—Ç @BotFather
- `ADMIN_IDS` - ID –∞–¥–º–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
- `TECH_CHANNEL_ID` - ID –∫–∞–Ω–∞–ª–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `DATABASE_URL` - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

### 3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

#### SQLite (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```bash
docker-compose up -d
```

#### PostgreSQL (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:

```env
DATABASE_URL=postgresql+asyncpg://botuser:changeme_strong_password@db:5432/report_bot
```

–ò –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
docker-compose up -d
```

### 4. –ó–∞–ø—É—Å–∫ –±–µ–∑ Docker

```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏ venv\Scripts\activate  # Windows

pip install -r requirements.txt
python -m bot.main
```

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- `/add_user` - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (reply –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ)
- `/add_ch <—Ç–∏–ø> <HH:MM> <–∫–ª—é—á–µ–≤–æ–µ_—Å–ª–æ–≤–æ> [–º–∏–Ω_—Ñ–æ—Ç–æ]` - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–∞–ª
- `/list_channels` - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤
- `/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∑–∞ –Ω–µ–¥–µ–ª—é

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–∞–Ω–∞–ª–∞

–í –≥—Ä—É–ø–ø–µ/–∫–∞–Ω–∞–ª–µ:

```
/add_ch –æ—Ç—á–µ—Ç1 09:00 –æ—Ç—á–µ—Ç1 2
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `–æ—Ç—á–µ—Ç1` - —Ç–∏–ø –æ—Ç—á–µ—Ç–∞
- `09:00` - –≤—Ä–µ–º—è –¥–µ–¥–ª–∞–π–Ω–∞
- `–æ—Ç—á–µ—Ç1` - –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ
- `2` - –º–∏–Ω–∏–º—É–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```
/add_user
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–∞–Ω–∞–ª–∞**: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–∞–Ω–∞–ª –∫–æ–º–∞–Ω–¥–æ–π `/add_ch`
2. **–û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ –∏ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
4. **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è**: –ï—Å–ª–∏ –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞ –æ—Ç—á–µ—Ç –Ω–µ —Å–¥–∞–Ω, –±–æ—Ç —Ç–µ–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–∞–Ω–∞–ª–µ
5. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–∞–Ω–∞–ª

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
report_bot/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ handlers/            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ database/            # –ú–æ–¥–µ–ª–∏ –∏ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ scheduler/           # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/         # Middleware
‚îÇ   ‚îî‚îÄ‚îÄ utils/               # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ .env.example
```

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ —Ñ–æ—Ç–æ

–í —Ñ–∞–π–ª–µ `bot/utils/validators.py` –µ—Å—Ç—å –∑–∞–≥–ª—É—à–∫–∞ `PhotoTemplateValidator`:

```python
async def validate_template(photo_file_id: str, template_type: str) -> bool:
    # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ OpenCV/–Ω–µ–π—Ä–æ—Å–µ—Ç–∏
    # –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å API –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    pass
```

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

- –ü—Ä–æ–≤–µ—Ä–∫—É —Ö–µ—à–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å OpenCV –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
- API –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤

### –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ PostgreSQL

1. –ò–∑–º–µ–Ω–∏—Ç–µ `DATABASE_URL` –≤ `.env`:

```env
DATABASE_URL=postgresql+asyncpg://user:password@host:5432/database
```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç - –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –õ–æ–≥–∏

–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:

```bash
docker-compose logs -f bot
```

## –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞

```bash
docker-compose down
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs bot`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–¥–∞–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª–∞—Ö

## –õ–∏—Ü–µ–Ω–∑–∏—è
