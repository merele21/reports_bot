# Telegram Bot –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –æ—Ç—á–µ—Ç–æ–≤ v2.0

–ë–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è —Å–¥–∞—á–∏ –æ—Ç—á–µ—Ç–æ–≤ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ –≤ Telegram-–∫–∞–Ω–∞–ª–∞—Ö –∏ —Ç–æ–ø–∏–∫–∞—Ö.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–Ω–∞–ª–æ–≤/—Ç–æ–ø–∏–∫–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–µ–¥–ª–∞–π–Ω–∞–º–∏
- üì∏ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
- üé® –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ç–æ –ø–æ —à–∞–±–ª–æ–Ω—É (perceptual hashing)
- üîë –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –≤ –æ—Ç—á–µ—Ç–∞—Ö
- ‚è∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ –≤ –æ–∫–Ω–µ +5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –¥–µ–¥–ª–∞–π–Ω–∞)
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç—Ä–µ–¥—ã
- üîß –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø—Ä–∞–≤
- üßµ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–æ–ø–∏–∫–æ–≤ (threads) –≤ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞—Ö
- üîÑ Hot reload –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- üíæ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
- üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üÜï –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ –≤–µ—Ä—Å–∏–∏ 2.0

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- **–°—É–ø–µ—Ä–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã**: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã**: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —à–∞–±–ª–æ–Ω–∞–º–∏
- –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ-—à–∞–±–ª–æ–Ω–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–æ—Ç–æ –≤ –æ–¥–Ω–æ–º —à–∞–±–ª–æ–Ω–µ
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤

### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏–π
- –ì–∏–±–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è–º–∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–µ–∑ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è
- –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

### Hot Reload
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞
- –£–¥–æ–±–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Python 3.11+
- aiogram 3.x
- SQLAlchemy 2.0
- APScheduler
- PostgreSQL / SQLite
- Pillow + ImageHash
- Alembic (–º–∏–≥—Ä–∞—Ü–∏–∏)
- Watchdog (hot reload)
- Docker

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository_url>
cd report_bot
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
nano .env
```

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```env
BOT_TOKEN=your_bot_token_here
ADMIN_IDS=123456789,987654321
SUPER_ADMIN_IDS=123456789
DATABASE_URL=sqlite+aiosqlite:///./bot_data.db
TZ=Europe/Moscow
MIN_PHOTOS=1
STATS_DAY=0
STATS_HOUR=9
STATS_MINUTE=0
```

### 3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –°–±–æ—Ä–∫–∞
docker-compose build

# –ó–∞–ø—É—Å–∫
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f bot
```

### 4. –ó–∞–ø—É—Å–∫ –±–µ–∑ Docker

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate  # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ (–º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
python -m bot.main
```

### 5. –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Hot Reload)

```bash
# Linux/Mac
chmod +x dev.sh
./dev.sh

# Windows
dev.bat

# –ò–ª–∏ —á–µ—Ä–µ–∑ make
make dev
```

## üìã –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### üë• –î–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```
/get_user_id    - –£–∑–Ω–∞—Ç—å —Å–≤–æ–π Telegram ID
/get_chat_id    - –£–∑–Ω–∞—Ç—å Chat ID (–ª–∏–º–∏—Ç: 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å)
/get_thread_id  - –£–∑–Ω–∞—Ç—å Thread ID (–ª–∏–º–∏—Ç: 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å)
/help           - –ü–æ–∫–∞–∑–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```

### üë®‚Äçüíº –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏:**
```
/add_ch <–Ω–∞–∑–≤–∞–Ω–∏–µ>              - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–∞–ª/—Ç—Ä–µ–¥
/rm_ch                          - –£–¥–∞–ª–∏—Ç—å –∫–∞–Ω–∞–ª –∏–∑ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
/list_channels                  - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è–º–∏:**
```
/add_event <–Ω–∞–∑–≤–∞–Ω–∏–µ> <HH:MM> <–∫–ª—é—á–µ–≤–æ–µ_—Å–ª–æ–≤–æ> [–º–∏–Ω_—Ñ–æ—Ç–æ]
/edit_event                     - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ
/rm_event                       - –£–¥–∞–ª–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ
```

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:**
```
/add_user                       - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (reply)
/add_users @user1;@user2        - –î–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
/rm_user                        - –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (reply)
/rm_users @user1;@user2         - –£–¥–∞–ª–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ
```

**–®–∞–±–ª–æ–Ω—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
```
/add_template                   - –î–æ–±–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω —Ñ–æ—Ç–æ (FSM)
/set_stats_destination          - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–µ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
/edit_wstat                     - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
/stats                          - –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
```

### ‚≠ê –î–ª—è —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

```
/add_admin                      - –î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (reply)
/rm_admin                       - –£–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (reply)
/list_admins                    - –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
```

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–∞–Ω–∞–ª–∞/—Ç—Ä–µ–¥–∞

–í –Ω—É–∂–Ω–æ–º —Ç–æ–ø–∏–∫–µ:

```
/add_ch –£—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—á–µ—Ç—ã
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

```
/add_event —É—Ç—Ä–µ–Ω–Ω–∏–π-–æ—Ç—á–µ—Ç 10:00 –æ—Ç—á–µ—Ç-—É—Ç—Ä–æ 2
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `—É—Ç—Ä–µ–Ω–Ω–∏–π-–æ—Ç—á–µ—Ç` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
- `10:00` - –≤—Ä–µ–º—è –¥–µ–¥–ª–∞–π–Ω–∞
- `–æ—Ç—á–µ—Ç-—É—Ç—Ä–æ` - –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ
- `2` - –º–∏–Ω–∏–º—É–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

### –®–∞–≥ 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```
/add_user
```

–ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ä–∞–∑—É:

```
/add_users @user1;@user2;@user3
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

–í —Ç—Ä–µ–¥–µ, –∫—É–¥–∞ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:

```
/set_stats_destination
```

### –®–∞–≥ 5 (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ —Ñ–æ—Ç–æ

```
/add_template
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ –æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ
/done
# –í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ /skip
```

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥–ª–∞–π–Ω–æ–≤

1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–µ–¥–ª–∞–π–Ω: `10:00`
2. –û–∫–Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∏: `10:04:00 - 10:04:59`
3. –û–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–ø—É—Å–∫–µ
4. –ó–∞–ø–∏—Å—å –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ**: –º–∏–Ω–∏–º—É–º N —Ñ–æ—Ç–æ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
2. **–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ**: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –≤ —Ç–µ–∫—Å—Ç–µ
3. **–®–∞–±–ª–æ–Ω** (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω):
   - MD5 —Ö–µ—à –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
   - Perceptual hash –¥–ª—è –ø–æ—Ö–æ–∂–∏—Ö (–¥–æ–ø—É—Å–∫ ‚â§10)

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è:
- –¢–æ–ø-10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º
- –í —Ç—Ä–µ–¥—ã, —É–∫–∞–∑–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `/set_stats_destination`

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
report_bot/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ + –∞–≤—Ç–æ-–º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py           # –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–æ–≤ + FSM
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reports.py         # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—á–µ—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stats.py           # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py          # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ engine.py          # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ crud.py            # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ scheduler/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks.py           # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py        # Middleware –¥–ª—è –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ validators.py      # –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ alembic/                   # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ versions/
‚îÇ   ‚îî‚îÄ‚îÄ env.py
‚îú‚îÄ‚îÄ dev.sh                     # Hot reload (Linux/Mac)
‚îú‚îÄ‚îÄ dev.bat                    # Hot reload (Windows)
‚îú‚îÄ‚îÄ Makefile                   # –£–¥–æ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ MIGRATION_GUIDE.md         # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é
```

## üóÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

- `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `channels` - –ö–∞–Ω–∞–ª—ã/—Ç–æ–ø–∏–∫–∏
- `user_channels` - –°–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–∞–Ω–∞–ª–∞–º–∏
- `photo_templates` - –®–∞–±–ª–æ–Ω—ã —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- `reports` - –û—Ç—á–µ—Ç—ã
- `stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏:
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
- –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –°–æ–±—ã—Ç–∏—è –∏ —à–∞–±–ª–æ–Ω—ã
- –ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á–µ—Ç–æ–≤

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### PostgreSQL

1. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ `db` –≤ `docker-compose.yml`
2. –û–±–Ω–æ–≤–∏—Ç–µ `.env`:

```env
DATABASE_URL=postgresql+asyncpg://botuser:password@db:5432/report_bot
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
docker-compose up -d
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```env
STATS_DAY=0      # 0=–ü–Ω, 1=–í—Ç, ..., 6=–í—Å
STATS_HOUR=17
STATS_MINUTE=30
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# Docker
docker-compose logs -f bot

# –ë–µ–∑ Docker
# –õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î (SQLite)

```bash
sqlite3 bot_data.db
.tables
SELECT * FROM channels;
SELECT * FROM user_channels;
```

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ë–æ—Ç –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–æ–º)
- –í–∫–ª—é—á–∏—Ç–µ Topics –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≥—Ä—É–ø–ø—ã

**–®–∞–±–ª–æ–Ω—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã Pillow –∏ imagehash
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç:**
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ª–∏ `/set_stats_destination`?
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ —Ç—Ä–µ–¥–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

**–î–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–ª–∏—Å—å:**
- –í –≤–µ—Ä—Å–∏–∏ 2.0 —ç—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª `bot_data.db` –Ω–µ –±—ã–ª —É–¥–∞–ª–µ–Ω
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å

## üìù Make –∫–æ–º–∞–Ω–¥—ã

```bash
make help       # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
make dev        # –ó–∞–ø—É—Å–∫ —Å hot reload
make run        # –û–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫
make migrate    # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (–Ω–µ –Ω—É–∂–Ω–æ –≤ v2.0)
make clean      # –û—á–∏—Å—Ç–∏—Ç—å cache
make install    # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –•—Ä–∞–Ω–∏—Ç–µ `.env` –≤ `.gitignore`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è PostgreSQL
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ `ADMIN_IDS` –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚úÖ `SUPER_ADMIN_IDS` - —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ –±–æ—Ç–∞
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –°–æ–∑–¥–∞–≤–∞–π—Ç–µ backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –≤–µ—Ä—Å–∏–∏ 1.x

–°–º. [MIGRATION_GUIDE.md](MIGRATION_GUIDE.md) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.

–ö—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è:

```bash
# 1. Backup
cp .env .env.backup
cp bot_data.db bot_data.db.backup

# 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
git pull
pip install -r requirements.txt

# 3. –î–æ–±–∞–≤–∏—Ç—å –≤ .env
echo "SUPER_ADMIN_IDS=your_id" >> .env

# 4. –ó–∞–ø—É—Å–∫ (–º–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
python -m bot.main
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
# Docker
docker-compose logs -f bot

# –§–∏–ª—å—Ç—Ä –ø–æ —É—Ä–æ–≤–Ω—é
docker-compose logs -f bot | grep ERROR
```

### –ú–µ—Ç—Ä–∏–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å:
- Prometheus
- Grafana
- Sentry (–¥–ª—è –æ—à–∏–±–æ–∫)

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∞—Ö –±–æ—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` —Ñ–∞–π–ª
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ [MIGRATION_GUIDE.md](MIGRATION_GUIDE.md)
5. –°–æ–∑–¥–∞–π—Ç–µ issue —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ –ª–æ–≥–∞–º–∏

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

[–£–∫–∞–∂–∏—Ç–µ –≤–∞—à—É –ª–∏—Ü–µ–Ω–∑–∏—é]

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- aiogram community
- SQLAlchemy team
- –í—Å–µ–º –∫–æ–Ω—Ç—Ä–∏–±—å—é—Ç–æ—Ä–∞–º

---

Made with ‚ù§Ô∏è for automation